众所周知，在java里是不能给构造函数写返回值的，如果在低版本的编译器定义一个构造器写上返回值可能会报错，高版本里面他就是一个普通的方法。可是如果构造函数没有返回值，那么比如Test t = new Test()我们new一个对象的时候是怎么赋值的呢？

### 构造函数有返回值吗

写一段代码测试一下：

``` java
public class Test {
    public Test() {
       
    }

    public static void main(String[] args) {
        Test t = new Test();
    }
}
```

反编译一下看看：

```java
 Code:
       0: new           #5 // class com/irving/utils/baidu/Test
       3: dup
       4: invokespecial #6 // Method "<init>":()V
       7: astore_1
       8: return
```



从反编译的结果看 4: invokespecial #7  // Method "init":()V，调用构造函数，V代表void无返回值，那么init代表什么含义？

我在书里找到这样一段话：

> 在 Java 虚拟机层面上，Java 语言中的构造函数是以一个名为init的特殊实例初始化方法的形式出现的，init这个方法名称是由编译器命名的，因为它并非一个合法的 Java 方法名字，不可能通过程序编码的方式实现。 实例初始化方法只能在实例的初始化期间，通过 Java 虚拟机的 invokespecial 指令来调用， 只有在实例正在构造的时候，实例初始化方法才可以被调用访问。
>
> 一个类或者接口最多可以包含不超过一个类或接口的初始化方法，类或者接口就是通过这个方法完成初始化的。这个方法是一个不包含参数的静态方法，名为clinit。这个名字也是由编译器命名的，因为它并非一个合法的 Java 方法名字，不可能通过程序编码的方式实现。 类或接口的初始化方法由 Java 虚拟机自身隐式调用，没有任何虚拟机字节码指令可以调用这个方法，只有在类的初始化阶段中会被虚拟机自身调用。

init代表着虚拟机调用构造函数，现在情况很明显，构造函数返回类型是void，那么它究竟是怎么赋值的呢？



### 赋值探究

我们明白一点，方法的调用过程就是栈帧入栈和出栈的过程，栈帧随着方法的调用创建，方法结束销毁。栈帧的内部包含局部变量表、操作数栈、动态链接等。

局部变量表表示方法调用时候的参数传递，当一个实例方法被调用的时候，第0个局部变量存储了当前实例方法所在对象的引用(this)，后续的其他参数传递至1到N的连续位置。

操作数栈用来准备方法调用的参数和返回结果。

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gizd04uk7rj31dy0euwhp.jpg)



以上面测试代码的方法来看Test t = new Test() 的调用过程：

1. new 创建Test对象，并将其引用值压入操作数栈顶
2. dup 复制栈顶数值并将复制值压入栈顶
3. invokespecial 使用dup复制的引用并用来初始化，此时栈顶应该只有new创建的原始引用
4. astore_1 将new创建的引用存入局部变量表索引为1的位置
5. return 方法正常返回

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1gizdubhp1rj31h207q777.jpg)

从这个过程我们已经看出来了，整个过程最后我们最终拿到了new之后创建的对象引用，并且保存到局部变量表中，可以供我们继续使用。

